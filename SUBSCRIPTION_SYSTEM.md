# Система управления подписками и уведомлений

## Реализованная функциональность

### 1. Исправлены модальные окна супер-админа

-   ✅ Модальные окна для продления подписки вынесены из таблицы
-   ✅ Исправлены проблемы с z-index и позиционированием
-   ✅ Добавлены Bootstrap классы для корректного отображения

### 2. Система уведомлений о подписках

-   ✅ Создана модель `SubscriptionNotification`
-   ✅ Добавлена миграция для таблицы уведомлений
-   ✅ Команда `subscriptions:check` для автоматической проверки подписок
-   ✅ Автоматическое создание уведомлений:
    -   Предупреждение за 7 дней до истечения
    -   Критическое уведомление при истечении подписки
-   ✅ Автоматическое отключение токенов при истечении подписки
-   ✅ Планировщик задач для ежедневной проверки в 9:00

### 3. Интерфейс уведомлений для клиентов

-   ✅ Блок уведомлений на главной панели клиента
-   ✅ Отдельная страница со всеми уведомлениями
-   ✅ Возможность отметить уведомления как прочитанные
-   ✅ Счетчик непрочитанных уведомлений в меню
-   ✅ Пагинация и сортировка уведомлений

### 4. Автоматическое восстановление токенов

-   ✅ При продлении подписки автоматически восстанавливаются токены
-   ✅ Отмечаются связанные уведомления как прочитанные
-   ✅ Логирование всех операций с токенами

### 5. Исправлены логи активности

-   ✅ Логирование удаления сотрудников ПЕРЕД удалением модели
-   ✅ Сохранение информации о сотруднике в логах
-   ✅ Добавлен метод удаления сотрудников для супер-админа

### 6. Добавлены tooltips

-   ✅ Все кнопки действий имеют подсказки
-   ✅ Инициализация Bootstrap tooltips на всех страницах
-   ✅ Описательные подсказки для лучшего UX

## Команды для управления

### Проверка подписок

```bash
php artisan subscriptions:check
```

### Планировщик задач (добавлен в routes/console.php)

```php
Schedule::command('subscriptions:check')->dailyAt('09:00');
```

### Для запуска планировщика в production

```bash
* * * * * cd /path-to-your-project && php artisan schedule:run >> /dev/null 2>&1
```

## Структура уведомлений

### Типы уведомлений:

-   `warning` - предупреждение за 7 дней до истечения
-   `expired` - критическое уведомление об истечении

### Автоматические действия:

1. При истечении подписки:
    - Отключаются все токены сотрудников клиента
    - Создается критическое уведомление
2. При продлении подписки:
    - Восстанавливаются токены активных сотрудников
    - Отмечаются связанные уведомления как прочитанные
    - Логируется количество восстановленных токенов

## Маршруты уведомлений

-   `GET /client/notifications` - страница всех уведомлений
-   `POST /client/notifications/{id}/mark-read` - отметить как прочитанное
-   `POST /client/notifications/mark-all-read` - отметить все как прочитанные

## Тестирование

Система протестирована с:

-   Клиентами с истекшими подписками
-   Клиентами с подписками, истекающими через несколько дней
-   Автоматическим отключением и восстановлением токенов
-   Отображением уведомлений в интерфейсе
-   Корректной работой планировщика задач

Вся функциональность работает корректно и готова к использованию.
